@model RaceAnalysis.Models.RaceFilterViewModel




@{
    var controllerName = HttpContext.Current.Request.RequestContext.RouteData.Values["controller"].ToString();
}


<link href="~/Content/css/select2.css" type="text/css" rel="stylesheet" />
<link rel="stylesheet" href="~/Content/select2-bootstrap.css">
<script src="~/Scripts/jquery-3.1.1.js"></script>
<script src="~/Scripts/select2.js"></script> 


@using (Html.BeginForm("SelectedRaces", controllerName, FormMethod.Post, new { @id = "myForm", @class = "form-inline" }))

{
    <div class="form-group">
        <label for="raceSelectId">Races:</label>
        @Html.ListBoxFor(m => m.SelectedRaceIds,
                new SelectList(Model.AvailableRaces, "RaceId", "DisplayName"),
                new { @id = "raceSelectId", multiple = "multiple" })
    </div>

    <div class="form-group">
        <label for="agSelectId">Age Groups:</label>
        @Html.ListBoxFor(m => m.SelectedAgeGroupIds,
                new SelectList(Model.AvailableAgeGroups, "AgeGroupId", "DisplayName"),
                new { @id = "agSelectId", multiple = "multiple" })
    </div>

    <div class="form-group">
        <label for="genderSelectId">Genders:</label>
        @Html.ListBoxFor(m => m.SelectedGenderIds,
                new SelectList(Model.AvailableGenders, "GenderId", "DisplayName"),
                new { @id = "genderSelectId", multiple = "multiple", })
    </div>

    <div class="btn-container">
        <button type="submit" id="submitButton" class="btn btn-primary"
                onclick="return DisplayProgressMessage(this, 'One Moment...')">
            Apply
        </button>
    </div>

}


        <script type="text/javascript">

            $(document).ready(function () {

                var $race_select = $("#raceSelectId").select2({
                    placeholder: "Select Races..",
                    width: '100%',
                    theme: "bootstrap"


                });
                var $ag_select = $("#agSelectId").select2({
                    placeholder: "Select Age Groups...",
                    width: '100%',
                    theme: "bootstrap"

                });
                var $gen_select = $("#genderSelectId").select2({
                    placeholder: "Select Genders..",
                    width: '100%',
                    theme: "bootstrap"
                });

                $('#myForm').validate({
                    errorElement: "div",
                    errorPlacement: function (error, element) {
                        element.after(error);
                    }
                });
                /*
           * When you change the value the select via select2, it triggers
           * a 'change' event, but the jquery validation plugin
           * only re-validates on 'blur'
           */
                $race_select.on('change', function () {
                    $(this).trigger('blur');
                });
                $ag_select.on('change', function () {
                    $(this).trigger('blur');
                });
                $gen_select.on('change', function () {
                    $(this).trigger('blur');
                });

                $race_select.rules('add', 'required');
                $ag_select.rules('add', 'required');
                $gen_select.rules('add', 'required');

                $('#myForm').validate({
                    ignore: 'input[type=hidden], .select2-input, .select2-focusser'
                });


            }());


        </script>
        <!--this is how I had to do it to work with Chrome.-->
        <script>
            function DisplayProgressMessage(ctl, msg) {
                $(ctl).text(msg);
                return true;
            }

            $("form").submit(function (event) {
                $('#submitButton').prop("disabled", "disabled");
            })
        </script>



