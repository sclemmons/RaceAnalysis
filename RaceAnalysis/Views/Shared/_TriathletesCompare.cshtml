@model RaceAnalysis.Models.TriathletesViewModel



@using RaceAnalysis.Helpers;
@using System.Web.Optimization
@using X.PagedList
@using X.PagedList.Mvc;
@using System.Runtime;


<!-- import the included stylesheet for some (very basic) default styling -->
<link href="/Content/PagedList.css" rel="stylesheet" type="text/css" />
<h3>@Model.TotalCount   Athletes</h3>


@using (Html.BeginForm("SelectedAthletes", "TriathletesCompare", FormMethod.Post))
{

       <div class="btn-container">
            <button type="submit" id="submitButton" class="btn btn-primary"
                    onclick="return DisplayProgressMessage(this, 'One Moment...')">
                Submit
            </button>
        </div>
        <!-- a paging control that lets the user navigation to the previous page, next page, etc -->
        <div id="pager-container">
            @Html.PagedListPager((IPagedList)Model.Triathletes,
                        page => Url.Action("DisplayPagedAthletes",
                        new RouteValueDictionary{
                            { "page", page },
                            { "races",  @String.Join(",",Model.Filter.SelectedRaceIds.Select(x => x.ToString()).ToArray())},
                            { "agegroups",  @String.Join(",",Model.Filter.SelectedAgeGroupIds.Select(x =>x.ToString()).ToArray()) },
                            { "genders" , @String.Join(",",Model.Filter.SelectedGenderIds.Select(x => x.ToString()).ToArray()) },
                            {"swimlowtimevalue", Model.Filter.SwimLow.TotalMinutes.ToString() },
                            {"swimhightimevalue", Model.Filter.SwimHigh.TotalMinutes.ToString() },

                            {"bikelowtimevalue", Model.Filter.BikeLow.TotalMinutes.ToString() },
                            {"bikehightimevalue", Model.Filter.BikeHigh.TotalMinutes.ToString() },

                            {"runlowtimevalue", Model.Filter.RunLow.TotalMinutes.ToString() },
                            {"runhightimevalue", Model.Filter.RunHigh.TotalMinutes.ToString() },

                            {"finishlowtimevalue", Model.Filter.FinishLow.TotalMinutes.ToString() },
                            {"finishhightimevalue", Model.Filter.FinishHigh.TotalMinutes.ToString() },

                            {"selectedIds" , ""}
                        }))
        </div>

        <div class="table-responsive">
            @Html.Partial("~/Views/Shared/_OnePageOfAthletes.cshtml", Model);
        </div>


        <script type="text/javascript">
            $("#pager-container").on('click', 'a', function () {
                $.ajax({
                    url: this.href + '&' + getSelectedIds(),
                    type: 'GET',
                    cache: false,
                    success: function (result) {
                        $('.table-responsive').html(result);
                    }
                });
                return false;
            });
            function getSelectedIds() {
                var selectedIds = "";
                $('input[type=checkbox]').each(function (index, element) {
                    if (this.checked) {
                        selectedIds += this.id + ",";
                    }
                });
                if (selectedIds.endsWith(","))
                    selectedIds = selectedIds.slice(0, -1);

                return "selectedAthletes=" + selectedIds;
            }
            function DisplayProgressMessage(ctl, msg) {
                $(ctl).text(msg);
                return true;
            }

            $("form").submit(function (event) {
                $('#submitButton').prop("disabled", "disabled");
            })
        </script>
        }



